เป้าหมาย

ตัวเลขหลังคำว่า “หวาน/หวานน้อย/หวานมาก” ส่วนใหญ่คือ เปอร์เซ็นต์ความหวาน

แต่บางครั้งผู้พูด ลืมพูดคำว่า “เปอร์เซ็นต์/ %” → เลยทำให้ AI ไปตีความว่าเป็น “จำนวนแก้ว” (ผิด)

เราเลยต้องมีกติกา กันหลง: ถ้าตัวเลขดู “ใหญ่ผิดปกติ” ให้ถือว่าเป็น ความหวาน ไม่ใช่จำนวน

กติกาหลัก (อ่านจบทำได้เลย)
1) คำบอกความหวาน (Sweet Keyword)

ถ้าเจอคำพวกนี้:

หวาน, หวานน้อย, หวานมาก, ไม่หวาน, หวานปกติ (แล้วแต่ที่คุณรองรับ)

ให้ถือว่า “กำลังพูดเรื่องระดับความหวาน” ของ “เมนูที่อยู่ใกล้ที่สุดก่อนหน้า”

2) ตัวเลขหลังความหวาน: แยก “เปอร์เซ็นต์” vs “จำนวน”

Rule A: ถ้ามีเครื่องหมาย % หรือคำว่า เปอร์เซ็นต์
→ ตีความเป็น ความหวานแน่นอน

“หวาน 50%” = sweetness 50

“หวานน้อย 25 เปอร์เซ็นต์” = sweetness 25

Rule B: ถ้าไม่มี % (ผู้พูดลืม)
ให้ใช้กติกา “กันหลง” ตามที่คุณบอก:

ถ้าเลขหลังคำหวาน/หวานน้อย มากกว่า 10 ให้แปลเป็น “ความหวาน (%)” ไม่ใช่จำนวน
และ qty ของรายการนั้น = 1

ตัวอย่าง:

“หวาน 50” → sweetness=50, qty=1

“หวานน้อย 25” → sweetness=25, qty=1

“หวาน 20” → sweetness=20, qty=1

เหตุผล: จำนวนสั่งจริง ๆ โอกาสพูด “50 แก้ว” แทบไม่มีในร้านทั่วไป และทำให้ระบบพัง

ถ้าคุณอยากเข้มขึ้นอีก: ใช้ “>10” หรือ “>=11” แล้วแต่ชอบ

3) “หวานน้อย 50” ต้องผูกกับเมนูเดียว ไม่แตกเป็น 2 รายการ

ปัญหาที่คุณเจอ:

“เลมอนหวานน้อย 50% 1”
ระบบไปแตกเป็น

“เลมอนหวานน้อย” qty=1

“%หวานน้อย” qty=1 ❌

Rule C: ความหวานเป็น “attribute” ไม่ใช่ “เมนู”

คำว่า “หวานน้อย/หวาน 50%” ต้องถูกเก็บเป็น field ในรายการเดิม เช่น sweetness=50, sweetnessLabel=หวานน้อย

ห้ามสร้างรายการใหม่จากคำว่า “หวาน/หวานน้อย”

วิธีคิดแบบง่าย:
เจอ “หวานน้อย/หวาน…” → ให้ย้อนกลับไป “แก้วล่าสุดที่เพิ่ง parse ได้” แล้วใส่ค่า sweetness ให้แก้วนั้น

4) ความหวานมีผลกับ “รายการที่พูดติดกันเท่านั้น”

กรณี:

“ชาเย็นบุก 2 โกโก้บุก 2 ชาเย็นหวานน้อย 50”

ตีความที่ถูก:

ชาเย็นบุก qty=2 (ปกติ)

โกโก้บุก qty=2 (ปกติ)

ชาเย็น qty=1, sweetness=50, label=หวานน้อย ✅

Rule D: คำความหวานจะ apply กับ ‘เมนูที่อยู่ติดกันก่อนหน้า’ (nearest previous item)
ไม่ย้อนกลับไปแก้ “ชาเย็นบุก 2” เพราะมันเป็นคนละรายการแล้ว

Output ที่ควรได้ (เพื่อ Preview ให้คนขาย)

ให้ Preview แสดง “ความหวาน” เป็นข้อความอ่านง่าย เช่น:

ชาเย็น (บุก) x2

โกโก้ (บุก) x2

ชาเย็น x1 — หวานน้อย 50%

แม้ผู้พูดจะพูด “หวานน้อย 50” (ไม่พูด %)
Preview ก็ควรเติมให้เป็น “50%” เพื่อให้คนขายทำออเดอร์ถูกต้อง

สรุปสั้นมาก (เอาไปใส่ spec ได้เลย)

เลขหลังคำว่า “หวาน/หวานน้อย”

ถ้ามี %/เปอร์เซ็นต์ → sweetness

ถ้าไม่มี และเลข > 10 → sweetness และ qty=1

“หวาน/หวานน้อย” เป็น attribute ของเมนูล่าสุด ห้ามแตกเป็นรายการใหม่

ความหวานผูกกับเมนูที่อยู่ใกล้ที่สุดก่อนหน้าเท่านั้น

Preview ต้องแสดงความหวานเป็น “xx%” เสมอ